<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>b0ec76ea804142b9b3286557c2eaceff</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<section id="imports" class="cell markdown">
<h1>imports</h1>
</section>
<div class="cell code" data-execution_count="1">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sb</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ipywidgets <span class="im">as</span> widgets</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
</div>
<section id="reading-and-processing-data" class="cell markdown">
<h1>Reading and processing data</h1>
</section>
<div class="cell code" data-execution_count="2">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Ratings <span class="op">=</span> pd.read_csv(<span class="st">&quot;ratings.csv&quot;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="3">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Ratings</span></code></pre></div>
<div class="output execute_result" data-execution_count="3">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>movieId</th>
      <th>rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>296</td>
      <td>5.0</td>
      <td>1147880044</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>306</td>
      <td>3.5</td>
      <td>1147868817</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>307</td>
      <td>5.0</td>
      <td>1147868828</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>665</td>
      <td>5.0</td>
      <td>1147878820</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>899</td>
      <td>3.5</td>
      <td>1147868510</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>25000090</th>
      <td>162541</td>
      <td>50872</td>
      <td>4.5</td>
      <td>1240953372</td>
    </tr>
    <tr>
      <th>25000091</th>
      <td>162541</td>
      <td>55768</td>
      <td>2.5</td>
      <td>1240951998</td>
    </tr>
    <tr>
      <th>25000092</th>
      <td>162541</td>
      <td>56176</td>
      <td>2.0</td>
      <td>1240950697</td>
    </tr>
    <tr>
      <th>25000093</th>
      <td>162541</td>
      <td>58559</td>
      <td>4.0</td>
      <td>1240953434</td>
    </tr>
    <tr>
      <th>25000094</th>
      <td>162541</td>
      <td>63876</td>
      <td>5.0</td>
      <td>1240952515</td>
    </tr>
  </tbody>
</table>
<p>25000095 rows × 4 columns</p>
</div>
</div>
</div>
<div class="cell code" data-execution_count="4">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Ratings.info()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 25000095 entries, 0 to 25000094
Data columns (total 4 columns):
 #   Column     Dtype  
---  ------     -----  
 0   userId     int64  
 1   movieId    int64  
 2   rating     float64
 3   timestamp  int64  
dtypes: float64(1), int64(3)
memory usage: 762.9 MB
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="5">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Ratings.isna().<span class="bu">sum</span>()</span></code></pre></div>
<div class="output execute_result" data-execution_count="5">
<pre><code>userId       0
movieId      0
rating       0
timestamp    0
dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="6">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Ratings.describe()</span></code></pre></div>
<div class="output execute_result" data-execution_count="6">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>movieId</th>
      <th>rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2.500010e+07</td>
      <td>2.500010e+07</td>
      <td>2.500010e+07</td>
      <td>2.500010e+07</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>8.118928e+04</td>
      <td>2.138798e+04</td>
      <td>3.533854e+00</td>
      <td>1.215601e+09</td>
    </tr>
    <tr>
      <th>std</th>
      <td>4.679172e+04</td>
      <td>3.919886e+04</td>
      <td>1.060744e+00</td>
      <td>2.268758e+08</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000e+00</td>
      <td>1.000000e+00</td>
      <td>5.000000e-01</td>
      <td>7.896520e+08</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>4.051000e+04</td>
      <td>1.196000e+03</td>
      <td>3.000000e+00</td>
      <td>1.011747e+09</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>8.091400e+04</td>
      <td>2.947000e+03</td>
      <td>3.500000e+00</td>
      <td>1.198868e+09</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.215570e+05</td>
      <td>8.623000e+03</td>
      <td>4.000000e+00</td>
      <td>1.447205e+09</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.625410e+05</td>
      <td>2.091710e+05</td>
      <td>5.000000e+00</td>
      <td>1.574328e+09</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="39">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Ratings[<span class="st">&quot;rating&quot;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="39">
<pre><code>4.0    6639798
3.0    4896928
5.0    3612474
3.5    3177318
4.5    2200539
2.0    1640868
2.5    1262797
1.0     776815
1.5     399490
0.5     393068
Name: rating, dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="43">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>group1 <span class="op">=</span> Ratings.loc[Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">==</span> <span class="fl">0.5</span>]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>group2 <span class="op">=</span> Ratings.loc[Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">==</span> <span class="fl">1.0</span>]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>group3 <span class="op">=</span> Ratings.loc[Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">==</span> <span class="fl">1.5</span>]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>group4 <span class="op">=</span> Ratings.loc[Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">==</span> <span class="fl">2.0</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>group5 <span class="op">=</span> Ratings.loc[Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">==</span> <span class="fl">2.5</span>]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>group6 <span class="op">=</span> Ratings.loc[Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">==</span> <span class="fl">3.0</span>]</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>group7 <span class="op">=</span> Ratings.loc[Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">==</span> <span class="fl">3.5</span>]</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>group8 <span class="op">=</span> Ratings.loc[Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">==</span> <span class="fl">4.0</span>]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>group9 <span class="op">=</span> Ratings.loc[Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">==</span> <span class="fl">4.5</span>]</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>group10 <span class="op">=</span> Ratings.loc[Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">==</span> <span class="fl">5.0</span>]</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(group1))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(group2))</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(group3))</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(group4))</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(group5))</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(group6))</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(group7))</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(group8))</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(group9))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(group10))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>393068
776815
399490
1640868
1262797
4896928
3177318
6639798
2200539
3612474
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="44">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sample_size <span class="op">=</span> <span class="dv">100000</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="bu">len</span>(Ratings)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>group_percentage <span class="op">=</span> sample_size <span class="op">/</span> total</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>group1_sample <span class="op">=</span> group1.sample(<span class="bu">round</span>(group_percentage<span class="op">*</span><span class="bu">len</span>(group1)))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>group2_sample <span class="op">=</span> group2.sample(<span class="bu">round</span>(group_percentage<span class="op">*</span><span class="bu">len</span>(group2)))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>group3_sample <span class="op">=</span> group3.sample(<span class="bu">round</span>(group_percentage<span class="op">*</span><span class="bu">len</span>(group3)))</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>group4_sample <span class="op">=</span> group4.sample(<span class="bu">round</span>(group_percentage<span class="op">*</span><span class="bu">len</span>(group4)))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>group5_sample <span class="op">=</span> group5.sample(<span class="bu">round</span>(group_percentage<span class="op">*</span><span class="bu">len</span>(group5)))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>group6_sample <span class="op">=</span> group6.sample(<span class="bu">round</span>(group_percentage<span class="op">*</span><span class="bu">len</span>(group6)))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>group7_sample <span class="op">=</span> group7.sample(<span class="bu">round</span>(group_percentage<span class="op">*</span><span class="bu">len</span>(group7)))</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>group8_sample <span class="op">=</span> group8.sample(<span class="bu">round</span>(group_percentage<span class="op">*</span><span class="bu">len</span>(group8)))</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>group9_sample <span class="op">=</span> group9.sample(<span class="bu">round</span>(group_percentage<span class="op">*</span><span class="bu">len</span>(group9)))</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>group10_sample <span class="op">=</span> group10.sample(<span class="bu">round</span>(group_percentage<span class="op">*</span><span class="bu">len</span>(group10)))</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>stratified_sample <span class="op">=</span> pd.concat([group1_sample,group2_sample,group3_sample,group4_sample,group5_sample,group6_sample,group7_sample,group8_sample,group9_sample,group10_sample])</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>stratified_sample</span></code></pre></div>
<div class="output execute_result" data-execution_count="44">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>movieId</th>
      <th>rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>22189820</th>
      <td>144308</td>
      <td>8665</td>
      <td>0.5</td>
      <td>1491018902</td>
    </tr>
    <tr>
      <th>7274634</th>
      <td>47153</td>
      <td>188093</td>
      <td>0.5</td>
      <td>1561597493</td>
    </tr>
    <tr>
      <th>18886662</th>
      <td>122455</td>
      <td>786</td>
      <td>0.5</td>
      <td>1143821500</td>
    </tr>
    <tr>
      <th>19954321</th>
      <td>129723</td>
      <td>1250</td>
      <td>0.5</td>
      <td>1446792763</td>
    </tr>
    <tr>
      <th>20838290</th>
      <td>135534</td>
      <td>8387</td>
      <td>0.5</td>
      <td>1145533975</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9690519</th>
      <td>62926</td>
      <td>112852</td>
      <td>5.0</td>
      <td>1454641563</td>
    </tr>
    <tr>
      <th>24796425</th>
      <td>161172</td>
      <td>480</td>
      <td>5.0</td>
      <td>1159536078</td>
    </tr>
    <tr>
      <th>19528192</th>
      <td>126788</td>
      <td>3033</td>
      <td>5.0</td>
      <td>976325364</td>
    </tr>
    <tr>
      <th>16781197</th>
      <td>108867</td>
      <td>3033</td>
      <td>5.0</td>
      <td>993439086</td>
    </tr>
    <tr>
      <th>3271660</th>
      <td>21601</td>
      <td>2959</td>
      <td>5.0</td>
      <td>1431787003</td>
    </tr>
  </tbody>
</table>
<p>99999 rows × 4 columns</p>
</div>
</div>
</div>
<div class="cell code" data-execution_count="46">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>stratified_sample.hist(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">15</span>))</span></code></pre></div>
<div class="output execute_result" data-execution_count="46">
<pre><code>array([[&lt;AxesSubplot:title={&#39;center&#39;:&#39;userId&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;movieId&#39;}&gt;],
       [&lt;AxesSubplot:title={&#39;center&#39;:&#39;rating&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;timestamp&#39;}&gt;]], dtype=object)</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_254e59b00f9f4349aebb8ddd0dc34c90/0bf6a1971718dd13d3fa242a3d274b598aafab9e.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="7">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>Movies <span class="op">=</span> pd.read_csv(<span class="st">&quot;movies.csv&quot;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="8">
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Movies</span></code></pre></div>
<div class="output execute_result" data-execution_count="8">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>movieId</th>
      <th>title</th>
      <th>genres</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Toy Story (1995)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Jumanji (1995)</td>
      <td>Adventure|Children|Fantasy</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Grumpier Old Men (1995)</td>
      <td>Comedy|Romance</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Waiting to Exhale (1995)</td>
      <td>Comedy|Drama|Romance</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Father of the Bride Part II (1995)</td>
      <td>Comedy</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>62418</th>
      <td>209157</td>
      <td>We (2018)</td>
      <td>Drama</td>
    </tr>
    <tr>
      <th>62419</th>
      <td>209159</td>
      <td>Window of the Soul (2001)</td>
      <td>Documentary</td>
    </tr>
    <tr>
      <th>62420</th>
      <td>209163</td>
      <td>Bad Poems (2018)</td>
      <td>Comedy|Drama</td>
    </tr>
    <tr>
      <th>62421</th>
      <td>209169</td>
      <td>A Girl Thing (2001)</td>
      <td>(no genres listed)</td>
    </tr>
    <tr>
      <th>62422</th>
      <td>209171</td>
      <td>Women of Devil's Island (1962)</td>
      <td>Action|Adventure|Drama</td>
    </tr>
  </tbody>
</table>
<p>62423 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell code" data-execution_count="9">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>Movies.info()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 62423 entries, 0 to 62422
Data columns (total 3 columns):
 #   Column   Non-Null Count  Dtype 
---  ------   --------------  ----- 
 0   movieId  62423 non-null  int64 
 1   title    62423 non-null  object
 2   genres   62423 non-null  object
dtypes: int64(1), object(2)
memory usage: 1.4+ MB
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="10">
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>Movies.isna().<span class="bu">sum</span>()</span></code></pre></div>
<div class="output execute_result" data-execution_count="10">
<pre><code>movieId    0
title      0
genres     0
dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="11">
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>Movies.describe()</span></code></pre></div>
<div class="output execute_result" data-execution_count="11">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>movieId</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>62423.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>122220.387646</td>
    </tr>
    <tr>
      <th>std</th>
      <td>63264.744844</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>82146.500000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>138022.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>173222.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>209171.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="38">
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>Movies[<span class="st">&quot;genres&quot;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="38">
<pre><code>Drama                                   9056
Comedy                                  5674
(no genres listed)                      5062
Documentary                             4731
Comedy|Drama                            2386
                                        ... 
Action|Adventure|Crime|Fantasy             1
Drama|Film-Noir|Musical|Thriller           1
Action|Drama|Horror|Mystery                1
Adventure|Comedy|Sci-Fi|Thriller|War       1
Comedy|Horror|Mystery|Sci-Fi|Western       1
Name: genres, Length: 1639, dtype: int64</code></pre>
</div>
</div>
<div class="cell markdown">
<p>corrolation and heat map</p>
</div>
<div class="cell code" data-execution_count="12">
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> Ratings.corr()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(corr_matrix[<span class="st">&#39;movieId&#39;</span>])</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>sb.heatmap(corr_matrix, cmap<span class="op">=</span><span class="st">&#39;coolwarm&#39;</span>, fmt<span class="op">=</span><span class="st">&quot;.9f&quot;</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Correlation Map&#39;</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>userId      -0.004413
movieId      1.000000
rating      -0.009216
timestamp    0.520900
Name: movieId, dtype: float64
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_254e59b00f9f4349aebb8ddd0dc34c90/281ac260df45f1bfd7abbe98a01ddf47a7a6b4eb.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="13">
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>features_for_clustering <span class="op">=</span> Movies[[<span class="st">&#39;genres&#39;</span>]].copy()  <span class="co"># Create a copy explicitly</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>features_for_clustering[<span class="st">&#39;genres&#39;</span>] <span class="op">=</span> features_for_clustering[<span class="st">&#39;genres&#39;</span>].astype(<span class="st">&#39;category&#39;</span>).cat.codes</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> StandardScaler().fit_transform(features_for_clustering)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>k_clusters <span class="op">=</span> <span class="dv">5</span>  <span class="co"># Adjust the number of clusters as needed</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>k_clusters, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>Movies[<span class="st">&#39;cluster&#39;</span>] <span class="op">=</span> kmeans.fit_predict(X)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the clustered movies</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cluster_id <span class="kw">in</span> <span class="bu">range</span>(k_clusters):</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    cluster_movies <span class="op">=</span> Movies[Movies[<span class="st">&#39;cluster&#39;</span>] <span class="op">==</span> cluster_id]</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;Cluster </span><span class="sc">{</span>cluster_id <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">:&quot;</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(cluster_movies[[<span class="st">&#39;title&#39;</span>, <span class="st">&#39;genres&#39;</span>]])</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Cluster 1:
                              title                               genres
13                     Nixon (1995)                                Drama
16     Sense and Sensibility (1995)                        Drama|Romance
21                   Copycat (1995)  Crime|Drama|Horror|Mystery|Thriller
23                    Powder (1995)                         Drama|Sci-Fi
24         Leaving Las Vegas (1995)                        Drama|Romance
...                             ...                                  ...
62410        Rimsky-Korsakov (1953)                                Drama
62413                Liberté (2019)                                Drama
62414   The Carpet of Horror (1962)                         Crime|Horror
62418                     We (2018)                                Drama
62419     Window of the Soul (2001)                          Documentary

[29037 rows x 2 columns]


Cluster 2:
                             title  \
0                 Toy Story (1995)   
5                      Heat (1995)   
12                    Balto (1995)   
19              Money Train (1995)   
22                Assassins (1995)   
...                            ...   
62329        Pressure Point (1997)   
62351       Hurricane Smith (1992)   
62368  Undercover Brother 2 (2019)   
62374                 Klaus (2019)   
62417   Santosh Subramaniam (2008)   

                                            genres  
0      Adventure|Animation|Children|Comedy|Fantasy  
5                            Action|Crime|Thriller  
12                    Adventure|Animation|Children  
19              Action|Comedy|Crime|Drama|Thriller  
22                           Action|Crime|Thriller  
...                                            ...  
62329                              Action|Thriller  
62351                                 Action|Drama  
62368                                Action|Comedy  
62374          Adventure|Animation|Children|Comedy  
62417                        Action|Comedy|Romance  

[5715 rows x 2 columns]


Cluster 3:
                                                   title  \
1                                         Jumanji (1995)   
7                                    Tom and Huck (1995)   
28     City of Lost Children, The (Cité des enfants p...   
32                               Wings of Courage (1995)   
47                                     Pocahontas (1995)   
...                                                  ...   
62383                              time for sushi (2017)   
62385              Yamasong: March of the Hollows (2017)   
62396                     Monkey Love Experiments (2014)   
62397                            Call of Cuteness (2017)   
62412                                The Painting (2019)   

                                         genres  
1                    Adventure|Children|Fantasy  
7                            Adventure|Children  
28       Adventure|Drama|Fantasy|Mystery|Sci-Fi  
32                       Adventure|Romance|IMAX  
47     Animation|Children|Drama|Musical|Romance  
...                                         ...  
62383                          Animation|Comedy  
62385                         Animation|Fantasy  
62396                           Animation|Drama  
62397                                 Animation  
62412                     Animation|Documentary  

[3769 rows x 2 columns]


Cluster 4:
                                title                     genres
8                 Sudden Death (1995)                     Action
9                    GoldenEye (1995)  Action|Adventure|Thriller
14            Cutthroat Island (1995)   Action|Adventure|Romance
43               Mortal Kombat (1995)   Action|Adventure|Fantasy
70                   Fair Game (1995)                     Action
...                               ...                        ...
62401   Tsar Ivan the Terrible (1991)         (no genres listed)
62407   The Riot and the Dance (2018)         (no genres listed)
62415          Mao Zedong 1949 (2019)         (no genres listed)
62421             A Girl Thing (2001)         (no genres listed)
62422  Women of Devil&#39;s Island (1962)     Action|Adventure|Drama

[7397 rows x 2 columns]


Cluster 5:
                                          title                genres
2                       Grumpier Old Men (1995)        Comedy|Romance
3                      Waiting to Exhale (1995)  Comedy|Drama|Romance
4            Father of the Bride Part II (1995)                Comedy
6                                Sabrina (1995)        Comedy|Romance
10               American President, The (1995)  Comedy|Drama|Romance
...                                         ...                   ...
62389               Very Well, Thank You (2007)          Comedy|Drama
62402                    Up to the World (2014)          Comedy|Drama
62411  And They Lived Happily Ever After (1976)                Comedy
62416                       Happy Flight (2008)          Comedy|Drama
62420                          Bad Poems (2018)          Comedy|Drama

[16505 rows x 2 columns]


</code></pre>
</div>
</div>
<section id="building-search-engine" class="cell markdown">
<h1>Building search engine</h1>
</section>
<div class="cell markdown">
<p>cleaning movie titles using regex</p>
</div>
<div class="cell markdown">
<p>function to go through all titles and remove any thing isn't a letter
or number</p>
</div>
<div class="cell code" data-execution_count="14">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Clean_title(title):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> re.sub(<span class="st">&quot;[^a-zA-Z0-9 ]&quot;</span>, <span class="st">&quot;&quot;</span>, title)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> title</span></code></pre></div>
</div>
<div class="cell markdown">
<p>take the title column go through ecah item in it and pass them into
this title function and add them a new column named Clean_title</p>
</div>
<div class="cell code" data-execution_count="15">
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>Movies[<span class="st">&quot;Clean_title&quot;</span>] <span class="op">=</span> Movies[<span class="st">&quot;title&quot;</span>].<span class="bu">apply</span>(Clean_title)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>data after clean</p>
</div>
<div class="cell code" data-execution_count="16">
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>Movies</span></code></pre></div>
<div class="output execute_result" data-execution_count="16">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>movieId</th>
      <th>title</th>
      <th>genres</th>
      <th>cluster</th>
      <th>Clean_title</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Toy Story (1995)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy</td>
      <td>1</td>
      <td>Toy Story 1995</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Jumanji (1995)</td>
      <td>Adventure|Children|Fantasy</td>
      <td>2</td>
      <td>Jumanji 1995</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Grumpier Old Men (1995)</td>
      <td>Comedy|Romance</td>
      <td>4</td>
      <td>Grumpier Old Men 1995</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Waiting to Exhale (1995)</td>
      <td>Comedy|Drama|Romance</td>
      <td>4</td>
      <td>Waiting to Exhale 1995</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Father of the Bride Part II (1995)</td>
      <td>Comedy</td>
      <td>4</td>
      <td>Father of the Bride Part II 1995</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>62418</th>
      <td>209157</td>
      <td>We (2018)</td>
      <td>Drama</td>
      <td>0</td>
      <td>We 2018</td>
    </tr>
    <tr>
      <th>62419</th>
      <td>209159</td>
      <td>Window of the Soul (2001)</td>
      <td>Documentary</td>
      <td>0</td>
      <td>Window of the Soul 2001</td>
    </tr>
    <tr>
      <th>62420</th>
      <td>209163</td>
      <td>Bad Poems (2018)</td>
      <td>Comedy|Drama</td>
      <td>4</td>
      <td>Bad Poems 2018</td>
    </tr>
    <tr>
      <th>62421</th>
      <td>209169</td>
      <td>A Girl Thing (2001)</td>
      <td>(no genres listed)</td>
      <td>3</td>
      <td>A Girl Thing 2001</td>
    </tr>
    <tr>
      <th>62422</th>
      <td>209171</td>
      <td>Women of Devil's Island (1962)</td>
      <td>Action|Adventure|Drama</td>
      <td>3</td>
      <td>Women of Devils Island 1962</td>
    </tr>
  </tbody>
</table>
<p>62423 rows × 5 columns</p>
</div>
</div>
</div>
<div class="cell markdown">
<p>creating TFIDF matrix</p>
</div>
<div class="cell markdown">
<p>convert movie title into set of numbers to find the most similar to
what is searched by using term frequency matrix doing inverse document
frequency to find unique terms and make vectors for each movie using
ngram range to ngram which is group of two words</p>
</div>
<div class="cell code" data-execution_count="17">
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>Vectorizer <span class="op">=</span> TfidfVectorizer(ngram_range<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>TFIDF <span class="op">=</span> Vectorizer.fit_transform(Movies[<span class="st">&quot;Clean_title&quot;</span>])</span></code></pre></div>
</div>
<div class="cell markdown">
<p>Creating the search function</p>
</div>
<div class="cell markdown">
<p>find the similarity of the term we enter to the similarity in other
terms in the dataset we have using cosine_similarity and numby and find
the five tittle with the highest similarity and show them using their
indicies</p>
</div>
<div class="cell code" data-execution_count="18">
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics.pairwise <span class="im">import</span> cosine_similarity</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> search(title):</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> Clean_title(title)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    Query_vec <span class="op">=</span> Vectorizer.transform([title])</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    Similarity <span class="op">=</span> cosine_similarity(Query_vec, TFIDF).flatten()</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    Indices <span class="op">=</span> np.argpartition(Similarity, <span class="op">-</span><span class="dv">5</span>)[<span class="op">-</span><span class="dv">5</span>:]</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    Results <span class="op">=</span> Movies.iloc[Indices].iloc[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Results</span></code></pre></div>
</div>
<div class="cell markdown">
<p>interactive search box using IPython.display</p>
</div>
<div class="cell code" data-execution_count="19">
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>movie_input <span class="op">=</span> widgets.Text(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    value<span class="op">=</span><span class="st">&#39;Toy Story&#39;</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    description<span class="op">=</span><span class="st">&#39;Movie Title:&#39;</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    disabled<span class="op">=</span><span class="va">False</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>movie_list <span class="op">=</span> widgets.Output()</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_type(data):</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> movie_list:</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>        movie_list.clear_output()</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> data[<span class="st">&quot;new&quot;</span>]</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(title) <span class="op">&gt;</span> <span class="dv">5</span>:</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>            display(search(title))</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>movie_input.observe(on_type, names<span class="op">=</span><span class="st">&#39;value&#39;</span>)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>display(movie_input, movie_list)</span></code></pre></div>
<div class="output display_data">
<div class="sourceCode" id="cb35"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;cbce37a6091148d0b6f3fdbb4fa2ecea&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb36"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;c13f20171bbe43f595c73625879152c0&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<section id="creating-the-recomendation-system" class="cell markdown">
<h1>Creating the recomendation system</h1>
</section>
<div class="cell markdown">
<p>find the users who liked the entered movie and find the other movies
they liked</p>
</div>
<div class="cell code" data-execution_count="20">
<div class="sourceCode" id="cb37"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>movie_id <span class="op">=</span> <span class="dv">1</span></span></code></pre></div>
</div>
<div class="cell markdown">
<p>find the other movies the used liked the entered movie and rated them
above 4</p>
</div>
<div class="cell code" data-execution_count="21">
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>similar_users <span class="op">=</span> Ratings[(Ratings[<span class="st">&quot;movieId&quot;</span>] <span class="op">==</span> movie_id) <span class="op">&amp;</span> (Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">&gt;</span> <span class="dv">4</span>)][<span class="st">&quot;userId&quot;</span>].unique()</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="22">
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>similar_user_recs <span class="op">=</span> Ratings[(Ratings[<span class="st">&quot;userId&quot;</span>].isin(similar_users)) <span class="op">&amp;</span> (Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">&gt;</span> <span class="dv">4</span>)][<span class="st">&quot;movieId&quot;</span>]</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="23">
<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>similar_user_recs</span></code></pre></div>
<div class="output execute_result" data-execution_count="23">
<pre><code>5101            1
5105           34
5111          110
5114          150
5127          260
            ...  
24998854    60069
24998861    67997
24998876    78499
24998884    81591
24998888    88129
Name: movieId, Length: 1358326, dtype: int64</code></pre>
</div>
</div>
<div class="cell markdown">
<p>show the movies the got 10% or higher that the users liked</p>
</div>
<div class="cell code" data-execution_count="24">
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>similar_user_recs <span class="op">=</span> similar_user_recs.value_counts() <span class="op">/</span> <span class="bu">len</span>(similar_users)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>similar_user_recs <span class="op">=</span> similar_user_recs[similar_user_recs <span class="op">&gt;</span> <span class="fl">.10</span>]</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="25">
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>similar_user_recs</span></code></pre></div>
<div class="output execute_result" data-execution_count="25">
<pre><code>1        1.000000
318      0.445607
260      0.403770
356      0.370215
296      0.367295
           ...   
953      0.103053
551      0.101195
1222     0.100876
745      0.100345
48780    0.100186
Name: movieId, Length: 113, dtype: float64</code></pre>
</div>
</div>
<div class="cell markdown">
<p>find the percentage of the regular people out side similar people
liked this movie</p>
</div>
<div class="cell code" data-execution_count="26">
<div class="sourceCode" id="cb45"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>all_users <span class="op">=</span> Ratings[(Ratings[<span class="st">&quot;movieId&quot;</span>].isin(similar_user_recs.index)) <span class="op">&amp;</span> (Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">&gt;</span> <span class="dv">4</span>)]</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="27">
<div class="sourceCode" id="cb46"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>all_users</span></code></pre></div>
<div class="output execute_result" data-execution_count="27">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>movieId</th>
      <th>rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>296</td>
      <td>5.0</td>
      <td>1147880044</td>
    </tr>
    <tr>
      <th>29</th>
      <td>1</td>
      <td>4973</td>
      <td>4.5</td>
      <td>1147869080</td>
    </tr>
    <tr>
      <th>48</th>
      <td>1</td>
      <td>7361</td>
      <td>5.0</td>
      <td>1147880055</td>
    </tr>
    <tr>
      <th>72</th>
      <td>2</td>
      <td>110</td>
      <td>5.0</td>
      <td>1141416589</td>
    </tr>
    <tr>
      <th>76</th>
      <td>2</td>
      <td>260</td>
      <td>5.0</td>
      <td>1141417172</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>25000062</th>
      <td>162541</td>
      <td>5618</td>
      <td>4.5</td>
      <td>1240953299</td>
    </tr>
    <tr>
      <th>25000065</th>
      <td>162541</td>
      <td>5952</td>
      <td>5.0</td>
      <td>1240952617</td>
    </tr>
    <tr>
      <th>25000078</th>
      <td>162541</td>
      <td>7153</td>
      <td>5.0</td>
      <td>1240952613</td>
    </tr>
    <tr>
      <th>25000081</th>
      <td>162541</td>
      <td>7361</td>
      <td>4.5</td>
      <td>1240953484</td>
    </tr>
    <tr>
      <th>25000090</th>
      <td>162541</td>
      <td>50872</td>
      <td>4.5</td>
      <td>1240953372</td>
    </tr>
  </tbody>
</table>
<p>1727573 rows × 4 columns</p>
</div>
</div>
</div>
<div class="cell markdown">
<p>find the movie people similar and not similar to us liked it and
recomend it and the movie must be higly recomended by the people who
watched it</p>
</div>
<div class="cell code" data-execution_count="28">
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>all_user_recs <span class="op">=</span> all_users[<span class="st">&quot;movieId&quot;</span>].value_counts() <span class="op">/</span> <span class="bu">len</span>(all_users[<span class="st">&quot;userId&quot;</span>].unique())</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="29">
<div class="sourceCode" id="cb48"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>all_user_recs</span></code></pre></div>
<div class="output execute_result" data-execution_count="29">
<pre><code>318      0.342220
296      0.284674
2571     0.244033
356      0.235266
593      0.225909
           ...   
551      0.040918
50872    0.039111
745      0.037031
78499    0.035131
2355     0.025091
Name: movieId, Length: 113, dtype: float64</code></pre>
</div>
</div>
<div class="cell markdown">
<p>compare the percentages to make a recomendation score using pandas
concate method to combine both recs we have</p>
</div>
<div class="cell code" data-execution_count="30">
<div class="sourceCode" id="cb50"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>rec_percentages <span class="op">=</span> pd.concat([similar_user_recs, all_user_recs], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>rec_percentages.columns <span class="op">=</span> [<span class="st">&quot;similar&quot;</span>, <span class="st">&quot;all&quot;</span>]</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="31">
<div class="sourceCode" id="cb51"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>rec_percentages</span></code></pre></div>
<div class="output execute_result" data-execution_count="31">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>similar</th>
      <th>all</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1.000000</td>
      <td>0.124728</td>
    </tr>
    <tr>
      <th>318</th>
      <td>0.445607</td>
      <td>0.342220</td>
    </tr>
    <tr>
      <th>260</th>
      <td>0.403770</td>
      <td>0.222207</td>
    </tr>
    <tr>
      <th>356</th>
      <td>0.370215</td>
      <td>0.235266</td>
    </tr>
    <tr>
      <th>296</th>
      <td>0.367295</td>
      <td>0.284674</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>953</th>
      <td>0.103053</td>
      <td>0.045792</td>
    </tr>
    <tr>
      <th>551</th>
      <td>0.101195</td>
      <td>0.040918</td>
    </tr>
    <tr>
      <th>1222</th>
      <td>0.100876</td>
      <td>0.066877</td>
    </tr>
    <tr>
      <th>745</th>
      <td>0.100345</td>
      <td>0.037031</td>
    </tr>
    <tr>
      <th>48780</th>
      <td>0.100186</td>
      <td>0.068314</td>
    </tr>
  </tbody>
</table>
<p>113 rows × 2 columns</p>
</div>
</div>
</div>
<div class="cell markdown">
<p>create the score</p>
</div>
<div class="cell code" data-execution_count="32">
<div class="sourceCode" id="cb52"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>rec_percentages[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> rec_percentages[<span class="st">&quot;similar&quot;</span>] <span class="op">/</span> rec_percentages[<span class="st">&quot;all&quot;</span>]</span></code></pre></div>
</div>
<div class="cell markdown">
<p>sort the recomendation using pandas sort value method desending</p>
</div>
<div class="cell code" data-execution_count="33">
<div class="sourceCode" id="cb53"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>rec_percentages <span class="op">=</span> rec_percentages.sort_values(<span class="st">&quot;score&quot;</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="34">
<div class="sourceCode" id="cb54"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>rec_percentages</span></code></pre></div>
<div class="output execute_result" data-execution_count="34">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>similar</th>
      <th>all</th>
      <th>score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1.000000</td>
      <td>0.124728</td>
      <td>8.017414</td>
    </tr>
    <tr>
      <th>3114</th>
      <td>0.280648</td>
      <td>0.053706</td>
      <td>5.225654</td>
    </tr>
    <tr>
      <th>2355</th>
      <td>0.110539</td>
      <td>0.025091</td>
      <td>4.405452</td>
    </tr>
    <tr>
      <th>78499</th>
      <td>0.152960</td>
      <td>0.035131</td>
      <td>4.354038</td>
    </tr>
    <tr>
      <th>4886</th>
      <td>0.235147</td>
      <td>0.070811</td>
      <td>3.320783</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2858</th>
      <td>0.216724</td>
      <td>0.167634</td>
      <td>1.292845</td>
    </tr>
    <tr>
      <th>296</th>
      <td>0.367295</td>
      <td>0.284674</td>
      <td>1.290232</td>
    </tr>
    <tr>
      <th>79132</th>
      <td>0.166817</td>
      <td>0.131384</td>
      <td>1.269693</td>
    </tr>
    <tr>
      <th>4973</th>
      <td>0.142501</td>
      <td>0.112405</td>
      <td>1.267747</td>
    </tr>
    <tr>
      <th>2959</th>
      <td>0.262649</td>
      <td>0.216717</td>
      <td>1.211946</td>
    </tr>
  </tbody>
</table>
<p>113 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell markdown">
<p>take the top ten rated movies and merge them with the data to get
their names</p>
</div>
<div class="cell code" data-execution_count="35">
<div class="sourceCode" id="cb55"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>rec_percentages.head(<span class="dv">10</span>).merge(Movies, left_index<span class="op">=</span><span class="va">True</span>, right_on<span class="op">=</span><span class="st">&quot;movieId&quot;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="35">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>similar</th>
      <th>all</th>
      <th>score</th>
      <th>movieId</th>
      <th>title</th>
      <th>genres</th>
      <th>cluster</th>
      <th>Clean_title</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.000000</td>
      <td>0.124728</td>
      <td>8.017414</td>
      <td>1</td>
      <td>Toy Story (1995)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy</td>
      <td>1</td>
      <td>Toy Story 1995</td>
    </tr>
    <tr>
      <th>3021</th>
      <td>0.280648</td>
      <td>0.053706</td>
      <td>5.225654</td>
      <td>3114</td>
      <td>Toy Story 2 (1999)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy</td>
      <td>1</td>
      <td>Toy Story 2 1999</td>
    </tr>
    <tr>
      <th>2264</th>
      <td>0.110539</td>
      <td>0.025091</td>
      <td>4.405452</td>
      <td>2355</td>
      <td>Bug's Life, A (1998)</td>
      <td>Adventure|Animation|Children|Comedy</td>
      <td>1</td>
      <td>Bugs Life A 1998</td>
    </tr>
    <tr>
      <th>14813</th>
      <td>0.152960</td>
      <td>0.035131</td>
      <td>4.354038</td>
      <td>78499</td>
      <td>Toy Story 3 (2010)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy|IMAX</td>
      <td>1</td>
      <td>Toy Story 3 2010</td>
    </tr>
    <tr>
      <th>4780</th>
      <td>0.235147</td>
      <td>0.070811</td>
      <td>3.320783</td>
      <td>4886</td>
      <td>Monsters, Inc. (2001)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy</td>
      <td>1</td>
      <td>Monsters Inc 2001</td>
    </tr>
    <tr>
      <th>580</th>
      <td>0.216618</td>
      <td>0.067513</td>
      <td>3.208539</td>
      <td>588</td>
      <td>Aladdin (1992)</td>
      <td>Adventure|Animation|Children|Comedy|Musical</td>
      <td>1</td>
      <td>Aladdin 1992</td>
    </tr>
    <tr>
      <th>6258</th>
      <td>0.228139</td>
      <td>0.072268</td>
      <td>3.156862</td>
      <td>6377</td>
      <td>Finding Nemo (2003)</td>
      <td>Adventure|Animation|Children|Comedy</td>
      <td>1</td>
      <td>Finding Nemo 2003</td>
    </tr>
    <tr>
      <th>587</th>
      <td>0.179400</td>
      <td>0.059977</td>
      <td>2.991150</td>
      <td>595</td>
      <td>Beauty and the Beast (1991)</td>
      <td>Animation|Children|Fantasy|Musical|Romance|IMAX</td>
      <td>2</td>
      <td>Beauty and the Beast 1991</td>
    </tr>
    <tr>
      <th>8246</th>
      <td>0.203504</td>
      <td>0.068453</td>
      <td>2.972889</td>
      <td>8961</td>
      <td>Incredibles, The (2004)</td>
      <td>Action|Adventure|Animation|Children|Comedy</td>
      <td>3</td>
      <td>Incredibles The 2004</td>
    </tr>
    <tr>
      <th>359</th>
      <td>0.253411</td>
      <td>0.085764</td>
      <td>2.954762</td>
      <td>364</td>
      <td>Lion King, The (1994)</td>
      <td>Adventure|Animation|Children|Drama|Musical|IMAX</td>
      <td>1</td>
      <td>Lion King The 1994</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<p>build the function by collecting the codes above</p>
</div>
<div class="cell code" data-execution_count="36">
<div class="sourceCode" id="cb56"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_similar_movies(movie_id):</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    similar_users <span class="op">=</span> Ratings[(Ratings[<span class="st">&quot;movieId&quot;</span>] <span class="op">==</span> movie_id) <span class="op">&amp;</span> (Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">&gt;</span> <span class="dv">4</span>)][<span class="st">&quot;userId&quot;</span>].unique()</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    similar_user_recs <span class="op">=</span> Ratings[(Ratings[<span class="st">&quot;userId&quot;</span>].isin(similar_users)) <span class="op">&amp;</span> (Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">&gt;</span> <span class="dv">4</span>)][<span class="st">&quot;movieId&quot;</span>]</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    similar_user_recs <span class="op">=</span> similar_user_recs.value_counts() <span class="op">/</span> <span class="bu">len</span>(similar_users)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    similar_user_recs <span class="op">=</span> similar_user_recs[similar_user_recs <span class="op">&gt;</span> <span class="fl">.10</span>]</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    all_users <span class="op">=</span> Ratings[(Ratings[<span class="st">&quot;movieId&quot;</span>].isin(similar_user_recs.index)) <span class="op">&amp;</span> (Ratings[<span class="st">&quot;rating&quot;</span>] <span class="op">&gt;</span> <span class="dv">4</span>)]</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    all_user_recs <span class="op">=</span> all_users[<span class="st">&quot;movieId&quot;</span>].value_counts() <span class="op">/</span> <span class="bu">len</span>(all_users[<span class="st">&quot;userId&quot;</span>].unique())</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    rec_percentages <span class="op">=</span> pd.concat([similar_user_recs, all_user_recs], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    rec_percentages.columns <span class="op">=</span> [<span class="st">&quot;similar&quot;</span>, <span class="st">&quot;all&quot;</span>]</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    rec_percentages[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> rec_percentages[<span class="st">&quot;similar&quot;</span>] <span class="op">/</span> rec_percentages[<span class="st">&quot;all&quot;</span>]</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    rec_percentages <span class="op">=</span> rec_percentages.sort_values(<span class="st">&quot;score&quot;</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rec_percentages.head(<span class="dv">10</span>).merge(Movies, left_index<span class="op">=</span><span class="va">True</span>, right_on<span class="op">=</span><span class="st">&quot;movieId&quot;</span>)[[<span class="st">&quot;score&quot;</span>, <span class="st">&quot;title&quot;</span>, <span class="st">&quot;genres&quot;</span>]]</span></code></pre></div>
</div>
<section id="build-the-interactive-weidget-to-do-all-stuf"
class="cell markdown">
<h1>build the interactive weidget to do all stuf</h1>
</section>
<div class="cell code" data-execution_count="37">
<div class="sourceCode" id="cb57"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>movie_name_input <span class="op">=</span> widgets.Text(</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    value<span class="op">=</span><span class="st">&#39;Toy Story&#39;</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    description<span class="op">=</span><span class="st">&#39;Movie Title:&#39;</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    disabled<span class="op">=</span><span class="va">False</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>recommendation_list <span class="op">=</span> widgets.Output()</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> on_type(data):</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> recommendation_list:</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>        recommendation_list.clear_output()</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> data[<span class="st">&quot;new&quot;</span>]</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(title) <span class="op">&gt;</span> <span class="dv">5</span>:</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>            results <span class="op">=</span> search(title)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>            movie_id <span class="op">=</span> results.iloc[<span class="dv">0</span>][<span class="st">&quot;movieId&quot;</span>]</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>            display(find_similar_movies(movie_id))</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>movie_name_input.observe(on_type, names<span class="op">=</span><span class="st">&#39;value&#39;</span>)</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>display(movie_name_input, recommendation_list)</span></code></pre></div>
<div class="output display_data">
<div class="sourceCode" id="cb58"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;ae8dbe3ffc6146198d47a329b1128b7a&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb59"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;f3348404009343c8bca36704709f8377&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
</body>
</html>
